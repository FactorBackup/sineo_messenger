{"version":3,"file":"iamport-ionic4-kcp.js.map","sources":["ng://iamport-ionic4-kcp/lib/iamport.payment.ts","ng://iamport-ionic4-kcp/lib/iamport.certification.ts","ng://iamport-ionic4-kcp/lib/iamport-ionic4-kcp.service.ts","ng://iamport-ionic4-kcp/lib/iamport-ionic4-kcp.module.ts"],"sourcesContent":["export class IamportPayment {\n\n    private success: boolean;\n    private status: string;\n    private response : object;\n\n    constructor(response : any) {\n        this.success = response.success;\n        this.status = response.status;\n        this.response = response;\n    }\n\n    public isSuccess() {\n        return this.success;\n    }\n\n    public getStatus() {\n        return this.status;\n    }\n\n    public getResponse() {\n        return this.response;\n    }\n\n}","export class IamportCertification {\n\n    private success: boolean;\n    private impUid: string;\n    private merchantUid: string;\n\n    constructor(response : any) {\n        this.success = response.success;\n        this.impUid = response.imp_uid;\n        this.merchantUid = response.merchant_uid;\n    }\n\n    public isSuccess() {\n        return this.success;\n    }\n\n    public getImpUid() {\n        return this.impUid;\n    }\n\n    public getMerchantUid() {\n        return this.merchantUid;\n    }\n\n}","import {Injectable} from '@angular/core';\nimport {IamportPayment} from \"./iamport.payment\";\nimport {IamportCertification} from \"./iamport.certification\";\nimport {Platform} from \"@ionic/angular\";\nimport {File} from \"@ionic-native/file/ngx\";\nimport {InAppBrowser} from \"@ionic-native/in-app-browser/ngx\";\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class IamportService {\n\n  constructor(private platform: Platform, private inAppBrowser: InAppBrowser, private file: File) {\n\n  }\n\n  private static parseQuery(query: string) {\n    let obj = {},\n        arr = query.split('&');\n\n    for (let element of arr) {\n      const pair = element.split(\"=\");\n      const key = decodeURIComponent(pair[0]);\n      const val = decodeURIComponent(pair[1]);\n\n      if (key === \"imp_success\") {\n        obj[\"success\"] = (\"true\" === val); //string ì boolean ì¼ë¡\n      } else {\n        obj[key] = val;\n      }\n    }\n\n    return obj;\n  }\n\n  public payment(userCode: string, param): Promise<IamportPayment> {\n    const promise = new Promise<IamportPayment>((resolve, reject) => {\n      this.platform.ready().then(() => {\n        let paymentUrl = '/_iamport_file_/www/iamport-checkout.html?user-code=' + userCode;\n        if (this.platform.is('ios')) {\n          paymentUrl = this.file.applicationDirectory + 'www/iamport-checkout-ios.html?user-code=' + userCode;\n        }\n\n        const redirectUrl = \"http://localhost/iamport\";\n        const browser = this.inAppBrowser.create(paymentUrl, '_blank', 'location=no');\n        let paymentProgress = false;\n\n        param.m_redirect_url = redirectUrl;\n\n        browser.on(\"loadstart\")\n            .subscribe(\n                (e) => {\n                  if (e.url.startsWith(redirectUrl)) {\n                    const query = e.url.substring(redirectUrl.length + 1);\n                    const data = IamportService.parseQuery(query);\n\n                    resolve(new IamportPayment(data));\n                    browser.close();\n                  }\n                }\n            );\n\n        browser.on(\"loadstop\")\n            .subscribe(\n                (e) => {\n                  if (!paymentProgress && (e.url).indexOf(paymentUrl) > -1) {\n                    paymentProgress = true;\n\n                    const inlineCallback = `(rsp) => {\n                                                        if( rsp.success ) {\n                                                            location.href = '${redirectUrl}?imp_success=true&imp_uid='+rsp.imp_uid+'&merchant_uid='+rsp.merchant_uid+'&vbank_num='+rsp.vbank_num+'&vbank_name='+rsp.vbank_name;\n                                                        } else {\n                                                            location.href = '${redirectUrl}?imp_success=false&imp_uid='+rsp.imp_uid+'&merchant_uid='+rsp.merchant_uid+'&error_msg='+rsp.error_msg;\n                                                        }\n                                                   }`;\n                    const iamport_script = `IMP.request_pay(${JSON.stringify(param)}, ${inlineCallback})`;\n\n                    browser.executeScript({\n                      code: iamport_script\n                    });\n                  }\n                }, (e) => {\n\n                }\n            );\n\n        browser.on(\"exit\")\n            .subscribe(\n                (e) => {\n                  reject(\"ì¬ì©ìê° ê²°ì ë¥¼ ì·¨ìíììµëë¤.\");\n                }\n            );\n\n        browser.show();\n      });\n    });\n\n    return promise;\n  }\n\n  public certification(userCode: string, param): Promise<IamportCertification> {\n    const promise = new Promise<IamportCertification>((resolve, reject) => {\n      this.platform.ready().then(() => {\n        let certificationUrl = '/_iamport_file_/www/iamport-checkout.html?user-code=' + userCode;\n        if (this.platform.is('ios')) {\n          certificationUrl = this.file.applicationDirectory + 'www/iamport-checkout-ios.html?user-code=' + userCode;\n        }\n\n        const redirectUrl = \"http://localhost/iamport-certification\";\n        const browser = this.inAppBrowser.create(certificationUrl, '_blank', 'location=no');\n\n        let certificationProgress = false;\n\n        browser.on(\"loadstart\")\n            .subscribe(\n                (e) => {\n                  if (e.url.startsWith(redirectUrl)) {\n                    const query = e.url.substring(redirectUrl.length + 1);\n                    const data = IamportService.parseQuery(query);\n\n                    resolve(new IamportCertification(data));\n                    browser.close();\n                  }\n                }\n            );\n\n        browser.on(\"loadstop\")\n            .subscribe(\n                (e) => {\n                  if (!certificationProgress && (e.url).indexOf(certificationUrl) > -1) {\n                    certificationProgress = true;\n\n                    const inlineCallback = `(rsp) => {\n                                                        if( rsp.success ) {\n                                                            location.href = '${redirectUrl}?imp_success=true&imp_uid='+rsp.imp_uid+'&merchant_uid='+rsp.merchant_uid;\n                                                        } else {\n                                                            location.href = '${redirectUrl}?imp_success=false&imp_uid='+rsp.imp_uid+'&merchant_uid='+rsp.merchant_uid;\n                                                        }\n                                                   }`;\n                    const iamport_script = `IMP.certification(${JSON.stringify(param)}, ${inlineCallback})`;\n\n                    browser.executeScript({\n                      code: iamport_script\n                    });\n                  }\n                }, (e) => {\n\n                }\n            );\n\n        browser.on(\"exit\")\n            .subscribe(\n                (e) => {\n                  reject(\"ì¬ì©ìê° ë³¸ì¸ì¸ì¦ì ì·¨ìíììµëë¤.\");\n                }\n            );\n\n        browser.show();\n      });\n    });\n\n    return promise;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { InAppBrowser } from \"@ionic-native/in-app-browser/ngx\";\n\n@NgModule({\n  declarations: [],\n  imports: [\n  ],\n  providers: [\n      InAppBrowser\n  ],\n  exports: []\n})\nexport class IamportIonic4KcpModule { }\n"],"names":["tslib_1.__values"],"mappings":"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"}
